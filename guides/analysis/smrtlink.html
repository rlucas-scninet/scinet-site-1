<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>SMRTLink/SMRTAnalysis using Command Line | SCINet | USDA Scientific Computing Initiative</title>



<meta name="description" content="Guide to use SMRTLink via CLI">



<link rel="shortcut icon" type="image/ico"
  href="/scinet-site/assets/uswds/img/favicons/favicon.ico">

<link rel="icon" type="image/png"
  href="/scinet-site/assets/uswds/img/favicons/favicon.png">

<link rel="icon" type="image/png"
  sizes="192x192"
  href="/scinet-site/assets/uswds/img/favicons/favicon-192.png">

<link rel="apple-touch-icon-precomposed" type=""
  href="/scinet-site/assets/uswds/img/favicons/favicon-57.png">

<link rel="apple-touch-icon-precomposed" type=""
  sizes="72x72"
  href="/scinet-site/assets/uswds/img/favicons/favicon-72.png">

<link rel="apple-touch-icon-precomposed" type=""
  sizes="114x114"
  href="/scinet-site/assets/uswds/img/favicons/favicon-114.png">

<link rel="apple-touch-icon-precomposed" type=""
  sizes="144x144"
  href="/scinet-site/assets/uswds/img/favicons/favicon-144.png">



  



<link rel="stylesheet"
  href="/scinet-site/assets/css/style.css"
  media="screen">

  
  


<!-- Digital Analytics Program roll-up, see https://analytics.usa.gov for data -->
<script id="_fed_an_ua_tag" src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=USDA&subagency=ARS"></script>


  
  <script>0</script>
</head>

<body class="site-90%">

  <a class="usa-skipnav" href="#main-content">Skip to main content</a>

  



  <section class="usa-banner" aria-label="Official government website">
  <div class="usa-accordion">
    <header class="usa-banner__header">
      <div class="usa-banner__inner">
        <div class="grid-col-auto">
          <img class="usa-banner__header-flag" src="/scinet-site/assets/uswds/img/us_flag_small.png" alt="U.S. flag">
        </div>
        <div class="grid-col-fill tablet:grid-col-auto">
          <p class="usa-banner__header-text">This is a demo of the redesigned SCINet website. <a href="https://scinet.usda.gov/" >Click here to visit the current website.</a></p>
        </div>
      </div>
    </header>
  </div>
</section>



<div class="usa-overlay"></div>
<header class="usa-header usa-header--extended sci-heading" role="banner">

  <div class="usa-navbar">
      
<div class="usa-logo">
    
    <span class="agency-logo display-flex flex-align-center margin-right-1">
        
        <a href="/scinet-site/">
            <img class="usa-logo-img"
                src="/scinet-site/assets/img/site/usda-logo-color.svg"
                alt="USDA">
        </a>
        
    </span>
    
    <a class="agency-logo-text"
        href="/scinet-site/"
        aria-label="SCINet Scientific Computing">
        <div class="agency-identity">
            <div class="agency-name usa-logo__text">SCINet Scientific Computing</div>
            
            <div class="tagline">U.S. Department of Agriculture</div>
            
        </div>
    </a>
</div>
    <button type="button" class="usa-menu-btn">Menu</button>
  </div>

  <nav aria-label="Primary navigation" class="usa-nav border-bottom-2px">
    <div class="usa-nav__inner">
      <button type="button" class="usa-nav__close">
        <img src="/scinet-site/assets/uswds/img/usa-icons/close.svg" alt="close">
      </button>
      
      
      
      <ul class="usa-nav__primary usa-accordion">
        
        <li class="usa-nav__primary-item">
          
          <a class=" usa-nav__link  "
            href="/scinet-site/">
            <span>Home</span>
          </a>
          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-About">
            <span>About</span>
          </button>

          
          

<ul id="nav-About" class="usa-nav__submenu" hidden="">

  
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/about/signup"><span>Sign up for an account</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/about/compute"><span>Computer Systems</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/about/organization"><span>Organization</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/about/contact"><span>Contact</span></a>
          </li>
          
      
</ul>
          

          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-News">
            <span>News</span>
          </button>

          
          

<ul id="nav-News" class="usa-nav__submenu" hidden="">

  
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/news/downtime"><span>System Downtime</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/news/announcements"><span>Announcements</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/news/stories"><span>User Stories</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/news/newsletter"><span>Newsletter</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/news/scinet-x"><span>SCINet-X</span></a>
          </li>
          
      
</ul>
          

          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-User Guides">
            <span>User Guides</span>
          </button>

          
          

<ul id="nav-User Guides" class="usa-nav__submenu" hidden="">

  
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/guides/start"><span>Quick Start</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/guides"><span>All User Guides</span></a>
          </li>
          
      
</ul>
          

          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-Research">
            <span>Research</span>
          </button>

          
          <ul id="nav-Research" class="usa-nav__submenu usa-megamenu" hidden="">
    <div class="grid-row grid-gap-4">
        
        
        <li class="desktop:grid-col-3"></li>
        
        
            
            
            
                <li class="usa-nav__submenu-item desktop:grid-col-3 m-top-0">
                    

                    
                    
                    <div class="">
                        <a href="/scinet-site/research/working-groups">
                            Working Groups
                        </a>
                    </div>

                    <ul id="nav-ResearchWorking Groups" class="sublist">


                        

                            <li>
                                <a class="sublinks" href="/scinet-site/research/working-groups/ag100pest">
                                    Ag100Pest
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/scinet-site/research/working-groups/arthropods">
                                    Arthropod Genomics
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/scinet-site/research/working-groups/geospatial">
                                    Geospatial Research
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/scinet-site/research/working-groups/microbiome">
                                    Microbiome
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/scinet-site/research/working-groups/LTARphenology">
                                    LTAR Phenology
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/scinet-site/research/working-groups/pollinator">
                                    Pollinator
                                </a>
                            </li>

                        
                    </ul>
                </li>
            
        
            
            
            
                <li class="usa-nav__submenu-item desktop:grid-col-3 m-top-0">
                    

                    
                    
                    <div class="">
                        <a href="/scinet-site/research/uses">
                            Use Cases
                        </a>
                    </div>

                    <ul id="nav-ResearchUse Cases" class="sublist">


                        

                            <li>
                                <a class="sublinks" href="/scinet-site/research/uses/genomics">
                                    Genomics
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/scinet-site/research/uses/plant-breeding">
                                    Plant breeding
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/scinet-site/research/uses/geospatial">
                                    Geospatial
                                </a>
                            </li>

                        

                            <li>
                                <a class="sublinks" href="/scinet-site/research/uses/hydrology">
                                    Hydrology
                                </a>
                            </li>

                        
                    </ul>
                </li>
            
        
    </div>


</ul>
          

          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-Training and Events">
            <span>Training and Events</span>
          </button>

          
          

<ul id="nav-Training and Events" class="usa-nav__submenu" hidden="">

  
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/training/learningpath"><span>Learning Pathway</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/training/free-online-training"><span>Free Online Training</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/training/events"><span>Upcoming Events</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/training/bioinformatics-workbook"><span>Bioinformatics Workbook</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/training/coursera"><span>Coursera</span></a>
          </li>
          
      
</ul>
          

          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-Support">
            <span>Support</span>
          </button>

          
          

<ul id="nav-Support" class="usa-nav__submenu" hidden="">

  
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/support/vrsc"><span>Virtual Research Support Core (VSRC)</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/support/faq"><span>FAQs</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="https://forum.scinet.usda.gov"><span>USDA-ARS SCINet Forum</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/support/request-storage"><span>Request Project Storage</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/support/request-software"><span>Request Software</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/support/request-AWS"><span>Request AWS</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/support/ceres-job-script"><span>Ceres Job Script Generator</span></a>
          </li>
          
      
</ul>
          

          
        </li>
        
        <li class="usa-nav__primary-item">
          

          
          
          
          <button type="button" class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-Opportunities">
            <span>Opportunities</span>
          </button>

          
          

<ul id="nav-Opportunities" class="usa-nav__submenu" hidden="">

  
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/opportunities/SAC"><span>SAC Membership</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/opportunities/request-workshop"><span>Request a Workshop</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/opportunities/fellowships"><span>Fellowships (PhD & MS)</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/opportunities/ai-innovation"><span>AI Innovation Fund</span></a>
          </li>
          
      
      
          <li class="usa-nav__submenu-item">
            <a
              href="/scinet-site/opportunities/scinet-aicoe-fellowships"><span>SCINet and AI-COE fellowship proposals</span></a>
          </li>
          
      
</ul>
          

          
        </li>
        


      </ul>
      

    </div>

    
    <div class="usa-nav__secondary">
      
      
      <form accept-charset="UTF-8" action="https://search.usa.gov/search" id="search_form" method="get"
        class="usa-search usa-search--small js-search-form">
        <input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="affiliate" id="affiliate" value="scinet-usda" />
        <div role="search">
          <label for="query" class="usa-sr-only">Enter search terms</label>
          <input autocomplete="off" class="usa-input usagov-search-autocomplete" id="query" name="query"
            type="search" />
          <button class="usa-button" type="submit" name="commit">
            <img src="/scinet-site/assets/uswds/img/usa-icons-bg/search--white.svg"
              class="usa-search__submit-icon" alt="Search" />
          </button>
        </div>
      </form>
      
    </div>


    </div>
    </div>
  </nav>

</header>



  

    


    
    


    

    

    
    
    




    
    


    <div class="grid-container main-side">


  


  

  







<div class="grid-row grid-gap flex-align-start">
    <div class="usa-layout-docs__sidenav desktop:grid-col-3 desktop:padding-y-10 usa-sticky-sidenav">
        <nav aria-label="Secondary navigation">
  <ul class="usa-sidenav">

    
    





<li class="usa-sidenav__item">
    <a href="/scinet-site/guides/start" 
        >
        Quick Start
    </a>
    
</li>
    
    





<li class="usa-sidenav__item">
    <a href="/scinet-site/guides" 
        >
        All User Guides
    </a>
    
</li>
    
    





<li class="usa-sidenav__item">
    <a href="/scinet-site/guides/analysis" 
         
        class=" guide-nav " 
        >
        SCINet Analysis
    </a>
    
</li>
    
    





<li class="usa-sidenav__item">
    <a href="/scinet-site/guides/analysis/galaxy" 
        >
        Galaxy on SCINet
    </a>
    
</li>
    
    





<li class="usa-sidenav__item">
    <a href="/scinet-site/guides/analysis/geneious" 
        >
        Geneious Software Guide
    </a>
    
</li>
    
    





<li class="usa-sidenav__item">
    <a href="/scinet-site/guides/analysis/r-perl-python" 
        >
        Guide to Installing R, Python, and Perl Packages
    </a>
    
</li>
    
    





<li class="usa-sidenav__item">
    <a href="/scinet-site/guides/analysis/r-studio" 
        >
        Rstudio Server
    </a>
    
</li>
    
    





<li class="usa-sidenav__item">
    <a href="/scinet-site/guides/analysis/rclone" 
        >
        Transferring files between a USDA Box account and SciNet
    </a>
    
</li>
    
    





<li class="usa-sidenav__item">
    <a href="/scinet-site/guides/analysis/smrtlink" 
         
        class="usa-current " 
        >
        SMRTLink/SMRTAnalysis using Command Line
    </a>
    
    
    <ul class="usa-sidenav__sublist">
        
            


<li>
  <a href="#instructions-for-smrtlink-v7" >
    Instructions for SMRTLink v7
  </a>
  <ul class="usa-sidenav__sublist">
    


<li>
  <a href="#view-the-available-pipelines" >View the available pipelines</a>
</li>





<li>
  <a href="#generate-a-template-file-for-pipelines" >Generate a template file for pipelines</a>
</li>





<li>
  <a href="#check-available-entry-points-for-the-pipeline" >Check available entry points (inputs) for the pipeline</a>
</li>





<li>
  <a href="#generate-workflow-template" >Generate workflow template</a>
</li>





<li>
  <a href="#generate-a-dataset" >Generate a dataset</a>
</li>





<li>
  <a href="#Sample-sbatch-script" >Sample sbatch script</a>
</li>



  </ul>
</li>





<li>
  <a href="#instructions-for-smrtlink-v10" >
    Instructions for SMRTLink v10
  </a>
  <ul class="usa-sidenav__sublist">
    


<li>
  <a href="#view-the-available-workflows" >View the available workflows</a>
</li>





<li>
  <a href="#view-input-options-for-a-workflow" >View input options for a workflow</a>
</li>





<li>
  <a href="#use-cromwell-config-files-for-ceres" >Use cromwell config files for Ceres</a>
</li>





<li>
  <a href="#sample-batch-script" >Sample batch script</a>
</li>



  </ul>
</li>



        
        
    </ul>
    
    
</li>
    

  </ul>
</nav>
    </div>
    
    <div class="usa-layout-docs__main desktop:grid-col-9">
        <nav class="usa-breadcrumb usa-breadcrumb--wrap" aria-label="Breadcrumbs">
  <ol class="usa-breadcrumb__list">
    
    


<li class="usa-breadcrumb__list-item">
  <a href="/scinet-site/" class="usa-breadcrumb__link">
    <span>SCINet Home</span>
  </a>
</li>

    
      


<li class="usa-breadcrumb__list-item">
  <a href="/scinet-site/guides" class="usa-breadcrumb__link">
    <span>All User Guides</span>
  </a>
</li>
    

    
      
      
        
          
          


<li class="usa-breadcrumb__list-item">
  <a href="/scinet-site/guides/analysis" class="usa-breadcrumb__link">
    <span>SCINet Analysis</span>
  </a>
</li>
        
      
    


    <li class="usa-breadcrumb__list-item usa-current" aria-current="page">
      <span>SMRTLink/SMRTAnalysis using Command Line</span>
    </li>
  </ol>
</nav>
        <main class="usa-layout-docs usa-layout-docs__main usa-prose" id="main-content">

          
  
      <h1 class="top-header">SMRTLink/SMRTAnalysis using Command Line</h1>
  
  

  

  

  <h2 id="instructions-for-smrtlink-v7">Instructions for SMRTLink v7</h2>

<p>Although SMRTLink GUI is useful, it can be very limited. In particular, currently one can not use priority nodes or high memory nodes through SMRTLink GUI. GUI service may also be unavailable at times. This, however, does not affect SMRTLink command line which does not need the GUI service to be alive.</p>

<h3 id="view-the-available-pipelines">View the available pipelines</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module load smrtlink/7.0.0
pbsmrtpipe show-templates
********************************************************
21 Registered User Pipelines (name -&gt; version, id, tags)
********************************************************
  1. Assembly (HGAP 4)                                        0.2.1    pbsmrtpipe.pipelines.polished_falcon_fat
      denovo
  2. Base Modification Detection                              0.1.0    pbsmrtpipe.pipelines.ds_modification_detection
      modification-detection
  3. Base Modification and Motif Analysis                     0.1.0    pbsmrtpipe.pipelines.ds_modification_motif_analysis    
      motif-analysis
  4. CCS with Mapping                                         0.1.0    pbsmrtpipe.pipelines.sl_subreads_to_ccs_align
      ccs,mapping
  5. Circular Consensus Sequences (CCS)                       0.2.0    pbsmrtpipe.pipelines.sl_subreads_to_ccs
      ccs
  6. Convert BAM to FASTX                                     0.1.0    pbsmrtpipe.pipelines.sa3_ds_subreads_to_fastx
      converters
  7. Convert RS to BAM                                        0.1.0    pbsmrtpipe.pipelines.sa3_hdfsubread_to_subread
      converters
  8. Demultiplex Barcodes                                     0.1.0    pbsmrtpipe.pipelines.sl_ccs_barcode
      barcode,ccs
  9. Demultiplex Barcodes                                     0.1.0    pbsmrtpipe.pipelines.sa3_ds_barcode2_manual
      barcode
 10. Iso-Seq                                                  0.1.1    pbsmrtpipe.pipelines.sa3_ds_isoseq3
      ccs,isoseq
 11. Iso-Seq Classify Only                                    0.1.1    pbsmrtpipe.pipelines.sa3_ds_isoseq3_classify
      ccs,isoseq
 12. Iso-Seq with Mapping                                     0.1.0    pbsmrtpipe.pipelines.sa3_ds_isoseq3_with_genome
      ccs,isoseq
 13. Long Amplicon Analysis (LAA)                             0.2.0    pbsmrtpipe.pipelines.sa3_ds_laa
      laa
 14. Long Amplicon Analysis with Guided Clustering (LAAgc)    0.1.0    pbsmrtpipe.pipelines.sa3_ds_laagc
      alpha,laa
 15. Mapping                                                  0.1.0    pbsmrtpipe.pipelines.sl_align_ccs
      ccs,mapping
 16. Minor Variants Analysis                                  0.2.0    pbsmrtpipe.pipelines.sl_minorseq_ccs
      minorvariants
 17. Minor Variants Analysis                                  0.2.0    pbsmrtpipe.pipelines.sa3_ds_minorseq
      beta,minorvariants
 18. Resequencing                                             0.2.0    pbsmrtpipe.pipelines.sl_resequencing2
      consensus,mapping,reports
 19. Site Acceptance Test (SAT)                               0.1.0    pbsmrtpipe.pipelines.sa3_sat
      consensus,mapping,reports,sat
 20. Structural Variant Calling                               2.0.0    pbsmrtpipe.pipelines.sa3_ds_sv2_ccs
      ccs,sv
 21. Structural Variant Calling                               2.0.0    pbsmrtpipe.pipelines.sa3_ds_sv2
      sv
Run with --show-all to display (unsupported) developer/internal pipelines
</code></pre></div></div>

<h3 id="generate-a-template-file-for-pipelines">Generate a template file for pipelines</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pbsmrtpipe show-template-details &lt;pipeline ID&gt; -j &lt;filename&gt;.json
</code></pre></div></div>

<p>Example below shows how to generate a template file for HGAP4 assembly.
The generated JSON file will contain options in the form of “KEY”: “VALUE“ that users could edit.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pbsmrtpipe show-template-details pbsmrtpipe.pipelines.polished_falcon_fat \
-j HGAP4-template.json
</code></pre></div></div>

<h3 id="check-available-entry-points-inputs-for-the-pipeline">Check available entry points (inputs) for the pipeline</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pbsmrtpipe show-template-details pbsmrtpipe.pipelines.polished_falcon_fat | grep -i entry
**** Entry points (1) ****
$entry:eid_subread
</code></pre></div></div>

<p>The value next to the “Entry points“ indicates the number of entry points. In this case, the entry point is a subreadset file. If a subreadset file does not exist or if there multiple subreadset files that you want to combine, <a href="#generate-a-dataset">click here</a> for instructions to create datasets.</p>

<h3 id="generate-workflow-template">Generate workflow template</h3>

<p>This template is used to talk to SLURM workload manager to divvy up tasks</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pbsmrtpipe show-workflow-options <span class="nt">-j</span> workflow-template.json
</code></pre></div></div>

<p>To submit jobs to a different partition replace the value for the pbsmrtpipe.options.cluster_manager KEY in the generated workflow template file with one of the provided options as shown below:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"pbsmrtpipe.options.cluster_manager"</span>: <span class="s2">"/system/smrtanalysis/7/slurm_template/short"</span>
<span class="s2">"pbsmrtpipe.options.cluster_manager"</span>: <span class="s2">"/system/smrtanalysis/7/slurm_template/medium"</span>
<span class="s2">"pbsmrtpipe.options.cluster_manager"</span>: <span class="s2">"/system/smrtanalysis/7/slurm_template/mem"</span>
</code></pre></div></div>

<p>Users can also copy the template directory and modify values to specify a different partition. For example, to submit jobs to priority partition, in your copy of the template directory make the following changes in file <em>jmsenv_00.ish</em> :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">JMSCONFIG_SLURM_PARTITION</span><span class="o">=</span><span class="s2">"priority"</span><span class="p">;</span>   <span class="c"># Partition </span>
<span class="nv">JMSCONFIG_SLURM_START_ARGS</span><span class="o">=</span><span class="s1">'--qos=gbru --timelimit=7-00:00:00'</span><span class="p">;</span>  <span class="c"># gbru is a example, choose relevant QOS</span>
</code></pre></div></div>

<p>in file <em>start.tmpl</em> :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--jmsenv</span> <span class="s2">"&lt;path_to_your_template_directory&gt;/jmsenv_00.ish"</span> <span class="c"># Change the path to your custom template file</span>
</code></pre></div></div>

<p>After these changes, make sure <em>“pbsmrtpipe.options.cluster_manager”:</em> in the workflow template file points to your template directory.</p>

<blockquote>
  <p>Note that only research groups that purchased nodes on the Ceres cluster have access to priority partitions.</p>
</blockquote>

<h3 id="generating-a-dataset">Generating a dataset</h3>

<p>Raw BAM files are usually accompanied by several XML files. In case the users don’t have these XML files, they can use the following command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dataset create
</code></pre></div></div>

<p>This command takes BAM, file of file names (fofn) or XML files as input.</p>

<p>For example, to analyze multiple XML SubreadSet files together, issue:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dataset create xyz123-combined.subreadset.xml <span class="k">*</span>.subreadset.xml
</code></pre></div></div>

<p>The following types are supported - <em>HdfSubreadSet, TranscriptAlignmentSet, ContigSet, DataSet,ConsensusReadSet, TranscriptSet, BarcodeSet, ReferenceSet, ConsensusAlignmentSet, GmapReferenceSet, AlignmentSet, SubreadSet</em></p>

<h3 id="sample-sbatch-script">Sample sbatch script</h3>

<p>After creating datasets, generating templates and making necessary changes, submit a batch job using sbatch command. Below is a sample job script to submit HGAP4 assembly using smrklink v7</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="c">#SBATCH --job-name=HGAP4_assembly</span>
<span class="c">#SBATCH --cpus-per-task=1</span>
<span class="c">#SBATCH --ntasks=2</span>
<span class="c">#SBATCH --mem-per-cpu=4000</span>
<span class="c">#SBATCH --partition=long</span>
<span class="c">#SBATCH --output=HGAP4__%j.std</span>
<span class="c">#SBATCH --error=HGAP4__%j.err</span>

module load smrtlink/7.0.0
<span class="nb">export </span><span class="nv">HOME</span><span class="o">=</span>/home/<span class="k">${</span><span class="nv">USER</span><span class="k">}</span>

pbsmrtpipe pipeline-id pbsmrtpipe.pipelines.polished_falcon_fat <span class="nt">-e</span> eid_subread:HGAP4-subreadset.xml <span class="se">\</span>
<span class="nt">--preset-json</span> HGAP4-template.json <span class="nt">--preset-json</span> workflow-template.json <span class="se">\</span>
<span class="nt">--output-dir</span> /path/to/output/dir

<span class="c">### Commands to get the above information ###</span>

<span class="c"># Pipeline id - pbsmrtpipe show-templates</span>
<span class="c"># Create dataset - dataset create HGAP4-subreadset.xml *.subreadset.xml</span>
<span class="c"># Generate template for assembly - pbsmrtpipe show-template-details pbsmrtpipe.pipelines.polished_falcon_fat -j HGAP4-template.json</span>
<span class="c"># Generate workflow template - pbsmrtpipe show-workflow-options -j workflow-template.json</span>
<span class="c"># To check the available entry points - pbsmrtpipe show-template-details pbsmrtpipe.pipelines.polished_falcon_fat</span>

<span class="c">#**** Pipeline Summary ****</span>
<span class="c">#id            : pbsmrtpipe.pipelines.polished_falcon_fat</span>
<span class="c">#version       : 0.2.1</span>
<span class="c">#name          : Assembly (HGAP 4)</span>
<span class="c">#Tags       : denovo</span>
<span class="c">#Description:</span>
<span class="c"># Same as polished_falcon_lean, but with reports.</span>

<span class="c">#**** Entry points (1) ****</span>
<span class="c">#$entry:eid_subread</span>
</code></pre></div></div>

<h2 id="instructions-for-smrtlink-v10">Instructions for SMRTLink v10</h2>

<p>Unlike v7 of SMRTLink, v10 uses <a href="https://cromwell.readthedocs.io/en/stable/">Cromwell workflow manager</a> which offers additional flexibility and compatibility with SLURM. Commandline version of v10 does not depend on web GUI service and is always available.</p>

<p>There are two main steps involved - provide input parameters for your workflow and then submit the job via SLURM.</p>

<h3 id="view-the-available-workflows">View the available workflows</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module load smrtlink/10.0.0
<span class="nv">$ </span>pbcromwell show-workflows


cromwell.workflows.pb_hgap4: Assembly <span class="o">(</span>HGAP4<span class="o">)</span>
cromwell.workflows.pb_basemods: Base Modification Analysis
cromwell.workflows.pb_ccs_demux: CCS with Demultiplexing
cromwell.workflows.pb_ccs_mapping: CCS with Mapping
cromwell.workflows.pb_ccs: Circular Consensus Sequencing <span class="o">(</span>CCS<span class="o">)</span>
cromwell.workflows.pb_bam2fastx: Convert BAM to FASTX
cromwell.workflows.pb_demux_subreads: Demultiplex Barcodes
cromwell.workflows.pb_demux_ccs: Demultiplex Barcodes
cromwell.workflows.pb_export_ccs: Export Reads
cromwell.workflows.pb_assembly_hifi: Genome Assembly
cromwell.workflows.pb_isoseq3_ccsonly: Iso-Seq Analysis
cromwell.workflows.pb_isoseq3: Iso-Seq Analysis
cromwell.workflows.pb_laa: Long Amplicon Analysis <span class="o">(</span>LAA<span class="o">)</span>
cromwell.workflows.pb_align_subreads: Mapping
cromwell.workflows.pb_align_ccs: Mapping
cromwell.workflows.pb_mark_duplicates: Mark PCR Duplicates
cromwell.workflows.pb_assembly_microbial: Microbial Assembly
cromwell.workflows.pb_mv_ccs: Minor Variants Analysis
cromwell.workflows.pb_resequencing: Resequencing
cromwell.workflows.pb_sat: Site Acceptance Test <span class="o">(</span>SAT<span class="o">)</span>
cromwell.workflows.pb_sv_ccs: Structural Variant Calling
cromwell.workflows.pb_sv_clr: Structural Variant Calling
cromwell.workflows.pb_trim_adapters: Trim gDNA Amplification Adapters
</code></pre></div></div>

<h3 id="view-input-options-for-a-workflow">View input options for a workflow</h3>

<p>Using <em>Genome Assembly</em> as an example -</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pbcromwell show-workflow-details pb_assembly_hifi


Workflow Summary
Workflow Id    : cromwell.workflows.pb_assembly_hifi
Name           : Genome Assembly
Description    : Genome assembly at any scale using HiFi reads
Required Inputs:
Optional Inputs: ConsensusReadSet XML
Tags           : ccs, assembly, cromwell
Task Options:
  reads <span class="o">=</span> None
    Reads <span class="o">(</span>file<span class="o">)</span>
  ipa2_genome_size <span class="o">=</span> 0
    Genome Length <span class="o">(</span>integer<span class="o">)</span>
  ipa2_downsampled_coverage <span class="o">=</span> 0
    Downsampled coverage <span class="o">(</span>integer<span class="o">)</span>
  ipa2_advanced_options <span class="o">=</span>
    Advanced Assembly Options <span class="o">(</span>string<span class="o">)</span>
  ipa2_run_polishing <span class="o">=</span> True
    Run polishing <span class="o">(</span>boolean<span class="o">)</span>
  ipa2_run_phasing <span class="o">=</span> True
    Run phasing <span class="o">(</span>boolean<span class="o">)</span>
  ipa2_run_purge_dups <span class="o">=</span> True
    Purge duplicate contigs from the assembly <span class="o">(</span>boolean<span class="o">)</span>
  ipa2_ctg_prefix <span class="o">=</span> ctg.
    Ipa2 ctg prefix <span class="o">(</span>string<span class="o">)</span>
  ipa2_reads_db_prefix <span class="o">=</span> reads
    Ipa2 reads db prefix <span class="o">(</span>string<span class="o">)</span>
  ipa2_cleanup_intermediate_files <span class="o">=</span> True
    Cleanup intermediate files <span class="o">(</span>boolean<span class="o">)</span>
  dataset_filters <span class="o">=</span>
    Filters to Add to the Data Set <span class="o">(</span>string<span class="o">)</span>
  filter_min_qv <span class="o">=</span> 20
    Min. CCS Predicted Accuracy <span class="o">(</span>Phred Scale<span class="o">)</span> <span class="o">(</span>integer<span class="o">)</span>


Example Usage:

  <span class="nv">$ </span>pbcromwell run pb_assembly_hifi <span class="se">\</span>

  <span class="nv">$ </span>pbcromwell run pb_assembly_hifi <span class="se">\</span>
      <span class="nt">-e</span> input1.consensusreadset.xml <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">reads</span><span class="o">=</span>None <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_genome_size</span><span class="o">=</span>0 <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_downsampled_coverage</span><span class="o">=</span>0 <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_advanced_options</span><span class="o">=</span><span class="s2">""</span> <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_run_polishing</span><span class="o">=</span>True <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_run_phasing</span><span class="o">=</span>True <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_run_purge_dups</span><span class="o">=</span>True <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_ctg_prefix</span><span class="o">=</span><span class="s2">"ctg."</span> <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_reads_db_prefix</span><span class="o">=</span><span class="s2">"reads"</span> <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_cleanup_intermediate_files</span><span class="o">=</span>True <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">dataset_filters</span><span class="o">=</span><span class="s2">""</span> <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">filter_min_qv</span><span class="o">=</span>20 <span class="se">\</span>
      <span class="nt">--config</span> cromwell.conf <span class="se">\</span>
      <span class="nt">--nproc</span> 8
</code></pre></div></div>

<h3 id="use-cromwell-config-files-for-ceres">Use cromwell config files for Ceres</h3>

<p>As shown above, the <em>pbcromwell run</em> command requires a cromwell config file for the jobs to be submitted via SLURM. On ceres, the config files are avaiable in a central location. Users can point to the files directly or can copy and modify based on their individual requirements. The config files are located at</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/system/smrtanalysis/10/slurm_template/cromwell-slurm-short.conf
/system/smrtanalysis/10/slurm_template/cromwell-slurm-medium.conf
/system/smrtanalysis/10/slurm_template/cromwell-slurm-mem.conf
</code></pre></div></div>
<p>The file names correspond to the partitions the jobs will be submitted to.</p>

<p>Priority users can copy those files to their work directory and modify the following (lines 130-131)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        runtime-attributes <span class="o">=</span> <span class="s2">"""
        Int cpu = 8
        Int requested_memory_mb_per_core = 8000
        String queue_name = "</span>short<span class="s2">"
        String? jms_args
        """</span>
</code></pre></div></div>

<p>to</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        runtime-attributes <span class="o">=</span> <span class="s2">"""
        Int cpu = 8
        Int requested_memory_mb_per_core = 8000
        String queue_name = "</span>priority<span class="s2">"
        String? jms_args = "</span><span class="nt">--qos</span><span class="o">=</span>your_QOS <span class="nt">--time</span><span class="o">=</span>14:00:00<span class="s2">" 
        """</span>
</code></pre></div></div>

<p>Users can also modify the CPU threads or memory per core values but these default values should suffice for most workflows.</p>

<h3 id="sample-batch-script">Sample batch script</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="c">#SBATCH -N 1 # No. of nodes used</span>
<span class="c">#SBATCH -n 4      # Threads </span>
<span class="c">#SBATCH -t 240    # Minutes</span>

module load smrtlink/10

pbcromwell run pb_assembly_hifi <span class="se">\</span>
      <span class="nt">-e</span> input1.consensusreadset.xml <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">reads</span><span class="o">=</span>None <span class="se">\ </span>                      <span class="c"># Task options vary based on the workflow</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_genome_size</span><span class="o">=</span>0 <span class="se">\ </span>              <span class="c"># These task options are optional and will use default values if not specified</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_downsampled_coverage</span><span class="o">=</span>0 <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_advanced_options</span><span class="o">=</span><span class="s2">""</span> <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_run_polishing</span><span class="o">=</span>True <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_run_phasing</span><span class="o">=</span>True <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_run_purge_dups</span><span class="o">=</span>True <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_ctg_prefix</span><span class="o">=</span><span class="s2">"ctg."</span> <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_reads_db_prefix</span><span class="o">=</span><span class="s2">"reads"</span> <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">ipa2_cleanup_intermediate_files</span><span class="o">=</span>True <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">dataset_filters</span><span class="o">=</span><span class="s2">""</span> <span class="se">\</span>
      <span class="nt">--task-option</span> <span class="nv">filter_min_qv</span><span class="o">=</span>20 <span class="se">\</span>
      <span class="nt">--config</span> /system/smrtanalysis/10/slurm_template/cromwell-slurm-short.conf <span class="se">\</span>
      <span class="nt">--nproc</span> 8 <span class="se">\ </span>                                    <span class="c"># this option is required for some stages in the pipeline</span>
      <span class="nt">--backend</span> SLURM <span class="se">\ </span>                              <span class="c"># Set the default backend</span>
      <span class="nt">--tmp-dir</span> <span class="se">\$</span><span class="o">{</span>TMPDIR<span class="o">}</span> <span class="se">\ </span>                         <span class="c"># Use TMPDIR variable</span>
      <span class="nt">-c</span> 8 <span class="se">\ </span>                                         <span class="c"># Number of chunks</span>
      <span class="nt">--output-dir</span> hifi-out			      <span class="c"># </span>
</code></pre></div></div>


  

  <br>

  


        <br>
    </main>
  </div>
</div>
</div>


    <br>

    

  

  


    
<footer class="usa-footer usa-footer--big">

  
  <div class="grid-container">
    <p>Last updated: November 01, 2022 at 12:45 PM</p>
  </div>
  

  
  <div class="grid-container usa-footer__return-to-top">
    <a href="#">Return to top</a>
  </div>
  

  
  

  <div class="usa-footer__primary-section">
    <div class="grid-container">
          <nav class="usa-footer__nav" aria-label="Footer navigation">
            <div class="grid-row grid-gap-4">
              
              <div class="mobile-lg:grid-col-6 desktop:grid-col-4">
                
                <section class="
                    usa-footer__primary-content
                    usa-footer__primary-content--collapsible
                  ">
                  <h4 class="usa-footer__primary-link">RESOURCES</h4>

                  <ul class="usa-list usa-list--unstyled">
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="mailto:scinet_vrsc@usda.gov">
                        Feedback
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="/scinet-site/about/signup">
                        Sign Up
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="/scinet-site/about/contact">
                        Contact
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="/scinet-site/opportunities/postdocs">
                        Fellowships
                      </a>
                    </li>
                    
                  </ul>
                  
              </div>
              
              <div class="mobile-lg:grid-col-6 desktop:grid-col-4">
                
                <section class="
                    usa-footer__primary-content
                    usa-footer__primary-content--collapsible
                  ">
                  <h4 class="usa-footer__primary-link">USDA</h4>

                  <ul class="usa-list usa-list--unstyled">
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://ask.usda.gov/">
                        AskUSDA
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://usda.gov/">
                        USDA.gov
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://www.usa.gov">
                        USA.gov
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://www.whitehouse.gov">
                        WhiteHouse.gov
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://usda.gov/plain-writing">
                        Plain Writing
                      </a>
                    </li>
                    
                  </ul>
                  
              </div>
              
              <div class="mobile-lg:grid-col-6 desktop:grid-col-4">
                
                <section class="
                    usa-footer__primary-content
                    usa-footer__primary-content--collapsible
                  ">
                  <h4 class="usa-footer__primary-link">LEGAL</h4>

                  <ul class="usa-list usa-list--unstyled">
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://usda.gov/accessibility-statement">
                        Accessibility Statement
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://usda.gov/non-discrimination-statement">
                        Non-Discrimination Statement
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://usda.gov/privacy-policy">
                        Privacy Policy
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://www.dm.usda.gov/foia/">
                        FOIA
                      </a>
                    </li>
                    
                    <li class="usa-footer__secondary-link">
                      <a
                        href="https://www.ocio.usda.gov/policy-directives-records-forms/information-quality-activities">
                        Information Quality
                      </a>
                    </li>
                    
                  </ul>
                  
              </div>
              
            </div>
          </nav>
    </div>
  </div>

  
  <div class="usa-footer__secondary-section">
    <div class="grid-container sci-heading">
      <div class="grid-row grid-gap">
        <div class="usa-footer__logo grid-row mobile-lg:grid-col-8 tablet:grid-gap-2">
          

          
          <div class="">
            
<div class="usa-logo">
    
    <span class="agency-logo display-flex flex-align-center margin-right-1">
        
        <a href="/scinet-site/">
            <img class="usa-logo-img"
                src="/scinet-site/assets/img/site/usda-logo-color.svg"
                alt="USDA">
        </a>
        
    </span>
    
    <a class="agency-logo-text"
        href="/scinet-site/"
        aria-label="SCINet Scientific Computing">
        <div class="agency-identity">
            <div class="agency-name usa-logo__text">SCINet Scientific Computing</div>
            
            <div class="tagline">U.S. Department of Agriculture</div>
            
        </div>
    </a>
</div>
          </div>
          
        </div>

        
        <div class="margin-y-auto mobile-lg:grid-col-4">
          
          <div class="usa-footer__social-links grid-row grid-gap-1">
            <div class="grid-col-auto">
              
              <a class="usa-social-link" href="https://twitter.com/USDA_ARS"
              ><img
                class="usa-social-link__icon"
                src="/scinet-site/assets/uswds/img/usa-icons/twitter.svg"
                alt="Twitter"
            /></a>
              
              <a class="usa-social-link" href="mailto:scinet_vrsc@usda.gov"
              ><img
                class="usa-social-link__icon"
                src="/scinet-site/assets/uswds/img/usa-icons/mail.svg"
                alt="Contact VRSC"
            /></a>
              
            </div>
          </div>
          
        </div>
        
      </div>
    </div>
  </div>
  

</footer>



  <!-- dynamically determine scripts needed for this config -->







  
    
      <script src="/scinet-site/assets/uswds/js/uswds.min.js" async></script>
    

  
    
      <script src="/scinet-site/assets/js/vendor/anchor.min.js"></script>
    

  
    
      <script src="/scinet-site/assets/js/main.js"></script>
    

  
    
      <script src="/scinet-site/assets/js/external.js"></script>
    

  
    




<script type="text/javascript">
//<![CDATA[
      var usasearch_config = { siteHandle:"scinet-usda" };

      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = "https://search.usa.gov/javascripts/remote.loader.js";
      document.getElementsByTagName("head")[0].appendChild(script);

//]]>
</script>






</body>

</html>